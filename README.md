![Python](https://img.shields.io/badge/-Python-black?style=for-the-badge&logo=python)
![ML](https://img.shields.io/badge/Machine_Learning-grey?style=for-the-badge)
![Scikit-learn](https://img.shields.io/badge/Scikit--Learn-white?style=for-the-badge&logo=scikitlearn)
![License](https://img.shields.io/badge/Apache_2.0-blue.svg?style=for-the-badge)

# Проект: ML-прогноз погоды (умная метеостанция)

Этот репозиторий содержит код для построения модели машинного обучения, прогнозирующей:
- температуру через 6 часов
- наличие дождя через 6 часов

Проект разработан в рамках учебного проекта IoT. Модель обучена на исторических погодных данных города Basel (Швейцария), так как реальный архив с погодой для Санкт-Петербурга был недоступен. Этот датасет выбран из-за схожести климатических условий и структуры признаков с данными, получаемыми от умной метеостанции. В будущем модель планируется дообучить на собственных метеонаблюдениях

## Репозитории проекта

- [meteostation-firmware](https://github.com/finstape/meteostation-firmware) — код Arduino + ESP
- [meteostation-backend](https://github.com/finstape/meteostation-backend) — backend-сервер (FastAPI + PostgreSQL)
- [meteostation-ml](https://github.com/finstape/meteostation-ml) — ML-модель прогнозирования погоды (этот репозиторий)

## Установка зависимостей

Для установки всех необходимых библиотек выполните следующую команду:

```bash
pip install -r requirements.txt
```

## Описание датасета

В качестве источника использован открытый погодный датасет города Basel. Данные представлены с шагом 1 час и содержат:
- температуру воздуха (°C)
- относительную влажность (%)
- атмосферное давление (переведено в мм рт. ст.)
- временную метку (преобразованную в час, день и месяц)

Целевой признак `Target_Rain` был сформирован на основе простой, но разумной эвристики: считается, что дождь вероятен, если через 6 часов наблюдаются **влажность выше 80%** и **давление ниже 755 мм рт. ст.**. Эта эвристика отражает типичное поведение осадков в умеренном климате при приближении циклона


## Описание файлов

| Файл             | Назначение |
|------------------|------------|
| `train.ipynb`    | Полный ноутбук с EDA, Feature Engineering, обучением моделей и сохранением |
| `weather.csv`    | Исторические погодные данные (температура, влажность, давление, дата/время) |
| `best_model.pkl` | Финальная обученная модель |
| `scaler.pkl`     | Масштабатор признаков, использованный при обучении |
| `main.py`        | Пример использования модели для предсказаний |

## Алгоритм

1. Загрузка и округление данных (точность = 1 знак после запятой)
2. Извлечение признаков времени (`Hour`, `DayOfMonth`, `Month`)
3. Формирование целевых переменных:
   - `Target_Temperature` через 6 часов
   - `Target_Rain` по эвристике (влажность > 80% и давление < 755)
4. Масштабирование признаков с помощью `StandardScaler` (важно для большинства моделей)
5. Обучение моделей:
   - KNN, XGBoost, LGBM, CatBoost, Ridge и др.
6. Подбор гиперпараметров через `GridSearchCV`
7. Сравнение по метрикам:
   - RMSE — для температуры (регрессия)
   - F1-score — для дождя (бинарная классификация)
8. Сохранение лучшей модели + scaler

## Полученные результаты

- Лучшая модель: **KNN**
- RMSE (ошибка температуры): **1.638**
- F1-score (предсказание дождя): **0.841**

## Как работает модель KNN

Алгоритм **K-ближайших соседей (KNN)** ищет K наиболее похожих наблюдений в обучающей выборке и использует их для предсказания.  
Для температуры — это усреднённые значения ближайших температур.  
Для дождя — доля "соседей", у которых был дождь, интерпретируется как вероятность.  
Модель не требует обучения в привычном смысле и показала наилучшие результаты на данной задаче

## Лицензия

Проект распространяется под лицензией **Apache License 2.0**.  
Разрешено свободное использование и модификация в образовательных и исследовательских целях
